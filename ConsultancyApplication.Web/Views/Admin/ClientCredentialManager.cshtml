@{
    ViewData["Title"] = "Müşteri Hesapları Yönetimi";
}

<link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet" />
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

<style>
    .tabulator {
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        font-size: 14px;
    }

        .tabulator .tabulator-header {
            background-color: #00896a;
            color: white;
            font-weight: bold;
        }

        .tabulator .tabulator-row {
            transition: background 0.2s ease;
        }

            .tabulator .tabulator-row:hover {
                background-color: #f3f3f3;
            }

    .btn-add-custom {
        background-color: #00b389;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

        .btn-add-custom:hover {
            background-color: #00926d;
        }

    .custom-card {
        background: #f9f9f9;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }
</style>

<div class="container mt-4">
    <div class="custom-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-success">
                <i class="mdi mdi-account-multiple-outline"></i>
                Müşteri Giriş Hesapları
            </h4>
            <button id="add-row" class="btn-add-custom">
                <i class="mdi mdi-plus-circle-outline"></i> Yeni Satır Ekle
            </button>
        </div>

        <div id="client-table"></div>
    </div>
</div>

<script>
    var table = new Tabulator("#client-table", {
        height: "500px",
        layout: "fitColumns",
        ajaxURL: "/Admin/GetClientCredentials",
        addRowPos: "top",
        columns: [
            { title: "Firma Adı", field: "companyName", editor: "input" },
            { title: "İlgili Kişi", field: "contactPerson", editor: "input" },
            { title: "Telefon", field: "phoneNumber", editor: "input" },
            { title: "Email", field: "email", editor: "input" },
            { title: "Portal Kullanıcı", field: "portalUsername", editor: "input" },
            { title: "Portal Şifre", field: "portalPassword", editor: "input" },
            { title: "App Şifre", field: "appPassword", editor: "input" },
            {
                title: "Sil",
                formatter: "buttonCross",
                width: 80,
                align: "center",
                cellClick: function (e, cell) {
                    let data = cell.getRow().getData();
                    if (confirm("Bu kaydı silmek istediğinizden emin misiniz?")) {
                        fetch("/Admin/DeleteClientCredential", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data.id)
                        }).then(res => res.json()).then(r => {
                            if (r.success) cell.getRow().delete();
                        });
                    }
                }
            }
        ],
        cellEdited: function (cell) {
            let rowData = cell.getRow().getData();
            fetch("/Admin/UpdateClientCredential", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(rowData)
            });
        }
    });

    document.getElementById("add-row").addEventListener("click", function () {
        table.addRow({});
    });
</script>
